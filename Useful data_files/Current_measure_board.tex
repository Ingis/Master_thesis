% Generated by GrindEQ Word-to-LaTeX 2012 
% ========== UNREGISTERED! ========== Please register! ==========
% LaTeX/AMS-LaTeX

\documentclass{article}

%%% remove comment delimiter ('%') and specify encoding parameter if required,
%%% see TeX documentation for additional info (cp1252-Western,cp1251-Cyrillic)
%\usepackage[cp1252]{inputenc}

%%% remove comment delimiter ('%') and select language if required
%\usepackage[english,spanish]{babel}

\usepackage{amssymb}
\usepackage{amsmath}

%%% remove comment delimiter ('%') and select graphics package
%%% for DVI output:
\usepackage[dvips]{graphicx}
%%% or for PDF output:
%\usepackage[pdftex]{graphicx}
%%% or for old LaTeX compilers:
%\usepackage[dvips]{graphics}

\begin{document}

%%% remove comment delimiter ('%') and select language if required
%\selectlanguage{spanish} 

\noindent \textbf{Tutorial: Current measurement board}

\noindent \textbf{}

\noindent This tutorial will give you an introduction how to use the Current measurement board. The current measurement board is a PCB specially designed for measuring small current signal.

\begin{enumerate}
\item  \textbf{Introduction to Board}
\end{enumerate}

\noindent 

\noindent The board consists of the following components.

\noindent  

\begin{enumerate}
\item  16-bit microcontroller (MSP430AFE2) manufactured by Texas Instruments  

\item  FTDI chip - which converts serial UART to USB, 

\item  Quad 2 to 1 multiplexer/demultiplexer

\item  Two switches

\item  Connectors for USB and JTAG
\end{enumerate}

\noindent 

\noindent There are two switches on the board: one switch (Switch1) is used for controlling the select signal for the multiplexer, and the other (Switch2) is used to switch power source between JTAG and USB. Three outputs of the multiplexer are connected to GPIO pins on the microcontroller, the fourth output is not used. The three inputs which are in use can be switched between \textit{RTS\_bar}, \textit{CTS\_bar,} and \textit{POWER\_ENABLE\_bar} signal from the FTDI chip (see data sheet of FTDI for further study).  

\noindent 

\noindent       Header J1        MSP430AFE530         FTDI chip           USB connector

\noindent \includegraphics*[width=4.86in, height=3.44in, keepaspectratio=false]{image1}

\noindent 

\noindent Figure \textbf{1}: Current measurement board layout

\noindent There are two 4-pin headers (J2 and J3), one 6-pin header (J1), and one 10-pin header (J4). The 4-pin header (J2) placed next to the FTDI chip, is used as a jumper which selects between 5 V and 3.3 V for the FTDI chip (if using external oscillator, FTDI chip required a 3.3 V power signal). The other 4-pin header (J3) is placed next to Switch2 and is used as a GPIO header, where 3 pins are connected to the multiplexer and the last pin is connected directly to the microcontroller. The 6-pin header (J1) is used for the ADC input and the 10-pin header (J4) is used for JTAG connection on the board.

\noindent 

\begin{enumerate}
\item  \textbf{Microcontroller}
\end{enumerate}

\noindent The microcontroller operates at the frequency of 12 MHz (system clock) but it can also support high frequency crystal oscillator up to 16 Mhz. The microcontroller has an internal 24-bit ADC. Since the microcontroller has 16-bit architecture, only 16-bits of the ADC are accessible at a time, check "MSP430x2xx Family User's Guide" under section "SD24\_A" for more information on how to use all of the 24 bits . The microcontroller has 3 differential ADC inputs, which means three different currents can be measured at the same time. 

\noindent \textbf{ }

\begin{enumerate}
\item \textbf{ Communication to PC}
\end{enumerate}

\noindent There are two types of interfaces available for serial communication, which are USART and SPI. The current measurement board is made to be used with USART serial interface. The serial pins on the board are connected to the FTDI chip, which convert USART serial interface to USB interface. By connecting to the USB connector, we get two-way serial communication between computer and microcontroller. This makes it possible to send data out from the microcontroller as well as send data in to the microcontroller.

\noindent \includegraphics*[width=4.22in, height=2.81in, keepaspectratio=false]{image2}

\noindent 

\noindent Figur \textbf{2}: Connections to the board

\begin{enumerate}
\item  \textbf{Software requirement and programing}
\end{enumerate}

\noindent To be able to program the microcontroller, the software Code Composer Studio (CCS) from Texas Instruments is needed together with JTAG-programmer. The free version of the software can be downloaded from: http://processors.wiki.ti.com/index.php/Download\_CCS. 

\noindent JTAG-TINY-V2 programmer should be available at the university to be used as a JTAG programmer. The TJAG programmer may need driver to work correctly, go to the link: https://www.olimex.com/Products/MSP430/JTAG/MSP430-JTAG-TINY-V2/ to download drivers if not automatically installed.

\noindent The FTDI chip should already been set up correctly, but if you want to edit settings on the FTDI chip, go into this site, and download the program \textit{MProg} form: http://www.ftdichip.com/Support/Utilities.htm to change settings.

\noindent To program the microcontroller, connect the cable between the 10-pin header (J4) and the JTAG-TINY-V2 programmer as shown in Figure 2. The green PWR light on the board should light up, if not, toggle the position of the Switch2, or connect a USB cable to the USB connector. Attached to this document you can find a C-code for reading data on the three differential ADC inputs, this can be opened and run in Code Composer Studio. A LABVIEW program can also be found among the attached files. Be sure to select correct serial port, when trying to run the LABVIEW program.

\noindent \textbf{}

\begin{enumerate}
\item \textbf{ How it works: Current measurement }
\end{enumerate}

\noindent A current is measured by adding a small resistor of known value in series of the signal you want to measure current of. By measuring voltage over that resistor you can calculate the current by using ohms law (I = U/R). The maximum voltage on each microcontroller pin is 3.3 V, which means the maximum voltage on the signal you want to measure, cannot be higher than 3.3 V. 

\noindent When using the ADC, the analog signals which you measure, are being compared with a reference voltage of 1.2 V. The reference voltage sets the maximum voltage, and the analog signal measured are being compared with this value. For example if you have a 130 mV signal on the input, the digital converted value will be  0.13/1.2 * 65535 = 7100. If we have done a measurement and only know the ADC-value, we can find the analog input by divide the ADC-value by 65535 (which is the maximum value for 16-bit), and then multiply with reference voltage, of 1.2 V. The lowest voltage that can be measured by a 16-bit ADC with a 1.2 V reference is 1.2/65535 = 18 µV.

\noindent \textit{}

\noindent When this board has been used before, it has been connected to a computer running a C-program in Code Composer Studio and a LABVIEW program communicating with the serial port. The C-program sends continuously ADC data-values out through the serial port to the LABVIEW program. In the labVIEW program the ADC values are converted to current values and are displayed for the viewer in LABVIEW. These values are also saved to disk as a text file.

\noindent \includegraphics*[width=5.03in, height=3.08in, keepaspectratio=false]{image3}

\noindent 

\noindent Figur \textbf{3}: LabVIEW program front panel

\noindent 


\end{document}

% == UNREGISTERED! == GrindEQ Word-to-LaTeX 2012 ==

